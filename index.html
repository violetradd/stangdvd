<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>stang screensaver</title>
    <style>
      :root {
        color-scheme: dark;
      }

      html,
      body {
        height: 100%;
        margin: 0;
      }

      body {
        overflow: hidden;
        background: #000 url("bg.jpg") center / cover no-repeat fixed;
      }

      #logo {
        position: fixed;
        left: 0;
        top: 0;
        width: 240px;
        height: auto;
        user-select: none;
        -webkit-user-drag: none;
        will-change: transform;
        pointer-events: none;
        z-index: 5;
        filter: drop-shadow(5px 5px 10px rgba(0, 0, 0, 0.5));
      }

      #date-banner {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 10px 14px;
        font: 500 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, Noto Sans, Helvetica, Arial, sans-serif;
        letter-spacing: 0.01em;
        color: rgba(255, 255, 255, 0.92);
        font-size: 40pt;
        text-align: center;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.72),
          rgba(0, 0, 0, 0.18)
        );
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        z-index: 10;
        user-select: none;
        pointer-events: none;
      }

      #date-banner[hidden] {
        display: none;
      }
    </style>
  </head>
  <body>
    <img id="logo" src="stang.svg" alt="stang" draggable="false" />
    <div id="date-banner" role="status" aria-live="polite" hidden></div>
    <script>
      (() => {
        const logo = document.getElementById("logo");
        const banner = document.getElementById("date-banner");

        // Dict: keys are MM-DD (local date), values are the banner text.
        const messagesByDate = {
          "02-05": "Happy Anniversary, Tristan!",
          "02-05": "Happy Birthday, Josh!",
          "04-15": "Happy Birthday, Violet!",
          "05-13": "Happy Birthday, Tristan!",
          "06-04": "Happy Anniversary, Violet!",
          "12-29": "Happy Anniversary, Josh!",
        };

        function pad2(n) {
          return String(n).padStart(2, "0");
        }

        function formatLocalDateMMDD(d) {
          return `${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
        }

        function setBannerForToday() {
          const key = formatLocalDateMMDD(new Date());
          const message = messagesByDate[key] ?? messagesByDate.default ?? "";
          if (!message) {
            banner.hidden = true;
            banner.textContent = "";
            return;
          }
          banner.textContent = message;
          banner.hidden = false;
        }

        function getBannerHeight() {
          if (banner.hidden) return 0;
          return banner.getBoundingClientRect().height;
        }

        setBannerForToday();

        const reduceMotion =
          window.matchMedia &&
          window.matchMedia("(prefers-reduced-motion: reduce)").matches;

        let x = 0;
        let y = 0;
        let vx = 260;
        let vy = 190;
        let lastT = null;

        function rand(min, max) {
          return min + Math.random() * (max - min);
        }

        function sign() {
          return Math.random() < 0.5 ? -1 : 1;
        }

        function getBounds() {
          const rect = logo.getBoundingClientRect();
          return { w: rect.width, h: rect.height };
        }

        function clampPosToViewport() {
          const { w, h } = getBounds();
          const vw = window.innerWidth;
          const vh = Math.max(0, window.innerHeight - getBannerHeight());
          x = Math.max(0, Math.min(vw - w, x));
          y = Math.max(0, Math.min(vh - h, y));
        }

        function pickReasonableSize() {
          if (!logo.naturalWidth || !logo.naturalHeight) return;
          const vw = window.innerWidth;
          const targetW = Math.max(140, Math.min(320, Math.floor(vw * 0.22)));
          logo.style.width = `${targetW}px`;
        }

        function init() {
          pickReasonableSize();

          const { w, h } = getBounds();
          const vw = window.innerWidth;
          const vh = Math.max(0, window.innerHeight - getBannerHeight());

          x = rand(0, Math.max(0, vw - w));
          y = rand(0, Math.max(0, vh - h));
          vx = rand(220, 360) * sign();
          vy = rand(160, 300) * sign();

          render();
          if (!reduceMotion) requestAnimationFrame(tick);
        }

        function render() {
          logo.style.transform = `translate3d(${x}px, ${y}px, 0)`;
        }

        function bounce() {
          const { w, h } = getBounds();
          const vw = window.innerWidth;
          const vh = Math.max(0, window.innerHeight - getBannerHeight());

          if (x <= 0) {
            x = 0;
            vx = Math.abs(vx);
          } else if (x + w >= vw) {
            x = vw - w;
            vx = -Math.abs(vx);
          }

          if (y <= 0) {
            y = 0;
            vy = Math.abs(vy);
          } else if (y + h >= vh) {
            y = vh - h;
            vy = -Math.abs(vy);
          }
        }

        function tick(t) {
          if (lastT == null) lastT = t;
          const dt = Math.min(0.05, (t - lastT) / 1000);
          lastT = t;

          x += vx * dt;
          y += vy * dt;
          bounce();
          render();

          requestAnimationFrame(tick);
        }

        window.addEventListener("resize", () => {
          pickReasonableSize();
          clampPosToViewport();
          render();
        });

        logo.addEventListener("load", init, { once: true });
        if (logo.complete) init();
      })();
    </script>
  </body>
</html>
